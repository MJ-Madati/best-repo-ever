This is my updated edit from branch 2.
